steps:
  - name: python:3.10.12-alpine3.18
    # entrypoint: sonar-scanner
    # args: [ '-Dsonar.host.url=https://sonarcloud.io','-Dsonar.organization=gcpsourcecodereposcanbc','-Dsonar.projectKey=gcpsourcecodereposcanbc_python-test','-Dsonar.login=${_SONAR_TOKEN}']
    # id: SAST Scan using SonarCloud in GCP DevSecOps Pipeline
    entrypoint: bash
    args: 
        - '-c'
        - |-
          apk update
          apk add musl-dev libpq-dev gcc
          pip3 install coverage flask psycopg2
          coverage run code/test_app.py && coverage xml
    id: Run coverage scan
  - name: sonarsource/sonar-scanner-cli:latest
    # entrypoint: sonar-scanner
    # args: [ '-Dsonar.host.url=https://sonarcloud.io','-Dsonar.organization=gcpsourcecodereposcanbc','-Dsonar.projectKey=gcpsourcecodereposcanbc_python-test','-Dsonar.login=${_SONAR_TOKEN}']
    # id: SAST Scan using SonarCloud in GCP DevSecOps Pipeline
    entrypoint: sonar-scanner
    args: ['sonar-scanner -Dsonar.login=${_SONAR_TOKEN}']          
    id: SAST Scan using SonarCloud in GCP DevSecOps Pipeline